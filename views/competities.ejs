<%- include('partials/header') %>

<main>
  <section class="comp__container">
    <% leagues.forEach(lg => { %>
      <section class="comp__card">
        <section class="card__icon">
          <% if (lg.imageUrl) { %>
            <img src="<%= lg.imageUrl %>" alt="<%= lg.name %>" onerror="this.src='/assets/default-league-logo.png';">
          <% } else { %>
            <img src="/assets/default-league-logo.png" alt="<%= lg.name %>">
          <% } %>
        </section>

        <section class="comp__card__content">
          <section class="comp__card__text">
            <p class="comp__card__title"><%= lg.name %></p>
            <p class="comp__card__description">
              <% if (lg.description) { %>
                <%= lg.description %>
              <% } else { %>
                Geen beschrijving beschikbaar.
              <% } %>
            </p>
          </section>

          <% if (user) { %>
            <section class="comp__card__buttons">
              <% if (lg.isBlacklisted) { %>
                <form action="/unblacklist-league/<%= lg.id %>" method="post" style="display: inline;">
                  <button type="submit" class="comp__card__button">Unblacklist</button>
                </form>
              <% } else { %>
                <form action="/blacklist-league/<%= lg.id %>" method="post" style="display: inline;">
                  <button type="submit" class="comp__card__button">Blacklist</button>
                </form>
              <% } %>

              <% if (lg.isFavorite) { %>
                <form action="/unfavorite-league/<%= lg.id %>" method="post" style="display: inline;">
                  <button type="submit" class="comp__card__button secondary">Verwijder favoriet</button>
                </form>
              <% } else { %>
                <form action="/favorite-league/<%= lg.id %>" method="post" style="display: inline;">
                  <button type="submit" class="comp__card__button secondary">Favoriet</button>
                </form>
              <% } %>
            </section>
          <% } else { %>
            <section class="comp__card__buttons">
              <button class="comp__card__button" onclick="alert('Log in om deze functie te gebruiken')">Blacklist</button>
              <button class="comp__card__button secondary" onclick="alert('Log in om deze functie te gebruiken')">Favoriet</button>
            </section>
          <% } %>
        </section>
      </section>
    <% }) %>
  </section>

  <div class="pagination-controls-leagues" style="text-align:center; margin: 1em 0;">
    <button id="prev-btn-leagues">Vorige</button>
    <span id="page-number-leagues">Pagina 1 van ...</span>
    <button id="next-btn-leagues">Volgende</button>
  </div>
</main>

<%- include("partials/footer") %>

<script>
  // Highlight actieve pagina in navigatie
  document.addEventListener("DOMContentLoaded", function () {
    const currentPage = window.location.pathname.split("/").pop();
    const navLinks = document.querySelectorAll("nav ul li a");
    navLinks.forEach(link => {
      if (link.getAttribute("href") === currentPage) {
        link.classList.add("active");
      }
    });
  });

  // Pagination voor competities
  const leagueCards = document.querySelectorAll('.comp__container .comp__card');
  const leaguesPerPage = 9;
  let currentLeaguePage = 1;
  const totalLeaguePages = Math.ceil(leagueCards.length / leaguesPerPage);

  function showLeaguePage(page) {
    if (page < 1) page = 1;
    if (page > totalLeaguePages) page = totalLeaguePages;
    currentLeaguePage = page;

    leagueCards.forEach(card => card.style.display = 'none');
    const start = (page - 1) * leaguesPerPage;
    const end = start + leaguesPerPage;
    for (let i = start; i < end && i < leagueCards.length; i++) {
      leagueCards[i].style.display = 'block';
    }

    document.getElementById('page-number-leagues').textContent = `Pagina ${currentLeaguePage} van ${totalLeaguePages}`;
    document.getElementById('prev-btn-leagues').disabled = currentLeaguePage === 1;
    document.getElementById('next-btn-leagues').disabled = currentLeaguePage === totalLeaguePages;
  }

  document.getElementById('prev-btn-leagues').addEventListener('click', () => {
    showLeaguePage(currentLeaguePage - 1);
  });
  document.getElementById('next-btn-leagues').addEventListener('click', () => {
    showLeaguePage(currentLeaguePage + 1);
  });

  // Init
  showLeaguePage(1);
</script>